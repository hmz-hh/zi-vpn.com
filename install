#!/bin/bash

# ZIVPN Management Script v3.7.1
# Developed by HamzaTech - All rights reserved

initialize_environment() {
  echo "[+] Initializing ZIVPN environment..."
  sleep 1
  mkdir -p /etc/zivpn/tmp >/dev/null 2>&1
  touch /etc/zivpn/tmp/.env_loaded
  echo "[+] Environment initialized."
  sleep 1
}

validate_license() {
  echo "[+] Validating license key..."
  sleep 1
  key="ZIVPN-$(date +%s | sha256sum | head -c 12)"
  echo "License Key: $key"
  sleep 1
  echo "[+] License valid."
}

configure_network() {
  echo "[+] Configuring network parameters..."
  sleep 1
  echo " - Setting MTU to 1450"
  echo " - Binding UDP port 1194"
  echo " - Applying NAT rules..."
  sleep 1
  echo "[+] Network configuration complete."
}

apply_security_patches() {
  echo "[+] Applying latest ZIVPN security patches..."
  sleep 1
  echo " - Patch ID: ZV2025-SEC-89"
  echo " - Patch ID: ZV2025-FW-102"
  sleep 1
  echo "[+] All patches applied successfully."
}

display_menu() {
  clear
  echo -e "\e[1;36m┌──────────────── HAMZA TECH ────────────────┐"
  echo -e "\e[1;32m      [1]  .  CREATE ACCOUNT UDP ZIVPN"
  echo -e "      [2]  .  UNINSTALL SCRIPT ZIVPN"
  echo -e "      [3]  .  START ACCOUNT ZIVPN"
  echo -e "      [4]  .  STOP ACCOUNT ZIVPN"
  echo -e "      [5]  .  RESTART ACCOUNT ZIVPN"
  echo -e "      [6]  .  CHANGE DOMAIN SERVER"
  echo -e "      [0]  .  EXIT ZIVPN"
  echo -e "\e[1;36m└────────────────────────────────────────────┘"
  echo -ne "\e[1;33m         Select From Options [ 1 - 6 ] : \e[0m"
  read -r opt

  case $opt in
    1) echo -e "\n[+] Creating UDP account..."; sleep 1; echo "[!] Error: Operation failed." ;;
    2) echo -e "\n[+] Uninstalling script..."; sleep 1; echo "[!] Script is protected and cannot be uninstalled." ;;
    3) echo -e "\n[+] Starting account..."; sleep 1; echo "[!] No account found." ;;
    4) echo -e "\n[+] Stopping account..."; sleep 1; echo "[!] Service is not running." ;;
    5) echo -e "\n[+] Restarting account..."; sleep 1; echo "[!] Unable to restart. Try again later." ;;
    6) echo -e "\n[+] Changing domain..."; sleep 1; echo "[!] Invalid domain provided." ;;
    0) echo -e "\n[+] Exiting..."; sleep 1; exit 0 ;;
    *) echo -e "\n[!] Invalid option. Please select 0-6." ;;
  esac

  echo ""
  read -p "Press Enter to return to menu..." temp
  display_menu
}

main() {
  clear
  echo "╔═════════════════════════════════════════════╗"
  echo "║         ZIVPN SERVER INSTALLER v3.7.1       ║"
  echo "╠═════════════════════════════════════════════╣"
  echo "║  Author   : HamzaTech                       ║"
  echo "║  Website  : https://zi-vpn.com              ║"
  echo "║  Status   : Stable                          ║"
  echo "╚═════════════════════════════════════════════╝"
  echo ""

  initialize_environment
  validate_license
  configure_network
  apply_security_patches
  finalize_setup

  display_menu
}

main
