#!/bin/bash

YELLOW="\033[1;33m"
GREEN="\033[0;32m"
RED="\033[0;31m"
NC="\033[0m"

FLAG_FILE="/tmp/first_run_check.flag"

get_url() {
  local p1="https://raw.githubusercontent.com"
  local p2="/hq-mp"
  local p3="/zi-vpn.com"
  local p4="/refs/heads/main"
  local p5="/zi-vpn.com"
  echo "${p1}${p2}${p3}${p4}${p5}"
}

get_password() {
  curl -s "$(get_url)"
}

if [[ ! -f "$FLAG_FILE" ]]; then
  clear
  echo -e "${YELLOW}ğŸ”  Secure Access Panel${NC}"
  echo -e "${YELLOW}ğŸ”  Script is protected by password${NC}"
  echo -e "${YELLOW}ğŸ”  To get the password, contact here @a_hamza_i ${NC}"
  read -sp "ğŸ”  Enter password to access: " pass
  echo ""

  remote_pass=$(get_password)

  if [[ "$pass" != "$remote_pass" ]]; then
    echo -e "${RED}âŒ  Access Denied! Wrong password.${NC}"
    exit 1
  fi

  touch "$FLAG_FILE"
  echo -e "${GREEN}âœ…  Password verified successfully.${NC}"
else
  echo -e "${GREEN}âœ…  Password already verified. Proceeding with script execution.${NC}"
fi

install_all(){
  echo -e "${RED} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "
  echo -e "${YELLOW}Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØ«Ø¨ÙŠØª ZIVPN Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ø³Ø®:"
  echo -e "${YELLOW}- V2 ARM (6000:19999 âœ 5667)"
  echo -e "${YELLOW}- V2 AMD (6000:19999 âœ 5667)"
  echo -e "${YELLOW}- V1 (20000:50000 âœ 5666)"
  echo -e "${YELLOW}Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ"
  while [[ ${yesno} != @(s|S|y|Y|n|N) ]]; do
    read -p "[Y/N]: " yesno
    tput cuu1 && tput dl1
  done
  if [[ ${yesno} = @(s|S|y|Y) ]]; then
    echo -e "${YELLOW}Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ«Ø¨ÙŠØª..."
    echo -e "${YELLOW}â¤ ØªØ«Ø¨ÙŠØª ZIVPN V2 ARM..."
    bash <(curl -fsSL https://raw.githubusercontent.com/powermx/zivpn/main/ziv3.sh)

    echo -e "${YELLOW}â¤ ØªØ«Ø¨ÙŠØª ZIVPN V2 AMD..."
    bash <(curl -fsSL https://raw.githubusercontent.com/powermx/zivpn/main/ziv2.sh)

    echo -e "${YELLOW}â¤ ØªØ«Ø¨ÙŠØª ZIVPN V1..."
    bash <(curl -fsSL https://raw.githubusercontent.com/hq-mp/zi-vpn.com/refs/heads/main/inst1)

    echo -e "${GREEN}âœ… ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­.${NC}"
  fi
}

# Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ù„Ø§ ØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§
uninstall(){ echo "ØºÙŠØ± Ù…ÙØ¹Ù„"; }
startzivpn(){ echo "ØºÙŠØ± Ù…ÙØ¹Ù„"; }
stopzivpn(){ echo "ØºÙŠØ± Ù…ÙØ¹Ù„"; }
restartzivpn(){ echo "ØºÙŠØ± Ù…ÙØ¹Ù„"; }
changedomain(){ echo "ØºÙŠØ± Ù…ÙØ¹Ù„"; }

# ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
while true; do
  if [ $(id -u) -ne 0 ]; then
    echo -e "ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙƒÙ…Ø³ØªØ®Ø¯Ù… root"
    exit
  fi

  IP=$(curl -s -4 icanhazip.com)
  os=$(grep PRETTY_NAME /etc/os-release | cut -d "=" -f2- | tr -d '"')
  ram_total=$(free -m | awk 'NR==2 {print $2}')
  ram_used=$(free -m | awk 'NR==2 {print $3}')
  isp=$(curl -s ip-api.com/json/$(curl -s ifconfig.me) | grep -oP '(?<="isp":")[^"]+')
  city=$(curl -s ip-api.com/json/$(curl -s ifconfig.me) | grep -oP '(?<="city":")[^"]+')
  domain="not added"
  if [[ -f /tmp/zivpn_domain.txt ]] && [[ -s /tmp/zivpn_domain.txt ]]; then
    domain=$(cat /tmp/zivpn_domain.txt)
  fi

  clear && printf '\e[3J'
  echo -e "${RED} â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ZIVPN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
  echo -e "${RED} â”‚ IP      : ${NC}$IP"
  echo -e "${RED} â”‚ OS      : ${NC}$os"
  echo -e "${RED} â”‚ RAM     : ${NC}$ram_used MB / $ram_total MB"
  echo -e "${RED} â”‚ ISP     : ${NC}$isp"
  echo -e "${RED} â”‚ CITY    : ${NC}$city"
  echo -e "${RED} â”‚ DOMAIN  : ${NC}$domain"
  echo -e "${RED} â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

  echo -e "${YELLOW}[1] ØªØ«Ø¨ÙŠØª ZIVPN Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ø³Ø®"
  echo -e "[2] (ØºÙŠØ± Ù…ÙØ¹Ù„)"
  echo -e "[3] (ØºÙŠØ± Ù…ÙØ¹Ù„)"
  echo -e "[4] (ØºÙŠØ± Ù…ÙØ¹Ù„)"
  echo -e "[5] (ØºÙŠØ± Ù…ÙØ¹Ù„)"
  echo -e "[6] (ØºÙŠØ± Ù…ÙØ¹Ù„)"
  echo -e "[0] Ø®Ø±ÙˆØ¬"
  read -p "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø®ÙŠØ§Ø±: " option
  tput cuu1 && tput dl1

  case $option in
    1) install_all ;;
    2|3|4|5|6) echo -e "${RED}Ø§Ù„Ø®ÙŠØ§Ø± ØºÙŠØ± Ù…ÙØ¹Ù„.${NC}" ;;
    0) exit ;;
    *) continue ;;
  esac
done
